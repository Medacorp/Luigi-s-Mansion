scoreboard players add @s FurnitureShakeTime 1
execute unless data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run tag @s[scores={AnimationProgress=0}] remove fake_shake
execute unless data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run tag @s[scores={AnimationProgress=0}] remove shake
execute unless data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run tag @s[scores={AnimationProgress=0}] remove long_shake
execute if data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run scoreboard players set @s FurnitureShakeTime -1
execute if entity @s[tag=!long_shake,tag=!use_medium_shake,tag=fake_shake] if data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run data modify entity @s data.animation set value {namespace:"luigis_mansion",id:"fake_shake"}
execute if entity @s[tag=!long_shake,tag=!use_medium_shake,tag=!fake_shake] if data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run data modify entity @s data.animation set value {namespace:"luigis_mansion",id:"short_shake"}
execute if entity @s[tag=use_medium_shake] if data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run data modify entity @s data.animation set value {namespace:"luigis_mansion",id:"medium_shake"}
execute if entity @s[tag=long_shake,tag=!use_medium_shake] if data entity @s data.animation{namespace:"luigis_mansion",id:"idle"} run data modify entity @s data.animation set value {namespace:"luigis_mansion",id:"long_shake"}
execute if entity @s[tag=!long_shake,tag=!shake,tag=!fake_shake,tag=was_shaking] unless entity @s[nbt=!{data:{animation:{namespace:"luigis_mansion",id:"fake_shake"}}},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"short_shake"}}},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"medium_shake"}}},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"long_shake"}}}] run data modify entity @s data.animation set value {namespace:"luigis_mansion",id:"idle"}

execute if entity @s[scores={Sound=0},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"fake_shake"}}},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"short_shake"}}},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"medium_shake"}}},nbt=!{data:{animation:{namespace:"luigis_mansion",id:"long_shake"}}}] unless entity @s[scores={FurnitureShakeTime=-1..0}] unless entity @s[scores={FurnitureShakeTime=3}] run function luigis_mansion:entities/furniture/shake_sound with entity @s data.shake_sound
execute if data entity @s[scores={Sound=0}] data.animation{namespace:"luigis_mansion",id:"fake_shake"} unless entity @s[scores={FurnitureShakeTime=-1..0}] unless entity @s[scores={FurnitureShakeTime=3}] run function luigis_mansion:entities/furniture/shake_sound with entity @s data.shake_sound
execute if data entity @s[scores={Sound=0}] data.animation{namespace:"luigis_mansion",id:"short_shake"} unless entity @s[scores={FurnitureShakeTime=-1..0}] unless entity @s[scores={FurnitureShakeTime=3}] run function luigis_mansion:entities/furniture/shake_sound with entity @s data.shake_sound
execute if data entity @s[scores={Sound=0}] data.animation{namespace:"luigis_mansion",id:"medium_shake"} unless entity @s[scores={FurnitureShakeTime=-1..0}] unless entity @s[scores={FurnitureShakeTime=2..5}] unless entity @s[scores={FurnitureShakeTime=7..10}] unless entity @s[scores={FurnitureShakeTime=12..15}] unless entity @s[scores={FurnitureShakeTime=17..20}] run function luigis_mansion:entities/furniture/shake_sound with entity @s data.shake_sound
execute if data entity @s[scores={Sound=0}] data.animation{namespace:"luigis_mansion",id:"long_shake"} unless entity @s[scores={FurnitureShakeTime=-1..0}] unless entity @s[scores={FurnitureShakeTime=2..10}] unless entity @s[scores={FurnitureShakeTime=12..16}] run function luigis_mansion:entities/furniture/shake_sound with entity @s data.shake_sound

tag @s add was_shaking
tag @s[tag=!fake_shake,tag=!shake,tag=!long_shake] remove was_shaking